# Checkpointing ガイド

## 基本操作

```text
# 巻き戻しメニューを開く
Esc + Esc  または  /rewind

# メニューで選択できるアクション
1. Restore code and conversation
   → コードと会話履歴を両方そのポイントに戻す
2. Restore conversation
   → 会話履歴のみ巻き戻し、コードの変更はそのまま保持
3. Restore code
   → ファイルの変更だけを元に戻す、会話は継続
4. Summarize from here
   → このメッセージ以降を圧縮サマリーに変換、コンテキストを解放
5. Never mind
   → 操作をキャンセルしてメニューを閉じる
```

## リスクの高い変更前のチェックポイント作成

```markdown
# 大きな変更を始める前のプロンプト例

まず現在の状態をチェックポイントとして記録してください。
次に、以下のリファクタリングを試行します。
失敗した場合は Esc+Esc でこのポイントに戻します。

【試行する変更】
src/auth/ 以下のクラスベースのコードを
関数ベースに書き換えてください。
```

## Summarize の活用

```markdown
# 長い試行錯誤の後でコンテキストを解放する

デバッグセッションが長くなった場合:
1. /rewind を開く
2. デバッグ開始のメッセージを選択
3. "Summarize from here" を選択
4. 要約への指示を入力:
   「バグの根本原因と最終的な修正内容のみを記録してください」
```

## 動作説明

- Checkpointing は Claude Code のファイル編集ツール（Write/Edit）で行った変更のみを追跡します
- 各ユーザーのプロンプト送信時にスナップショットが自動で作成されます
- スナップショットはセッション終了後も30日間保持されます（2026年2月時点）

## 注意事項

- bash コマンドで行ったファイル変更（rm, mv, cp など）は追跡対象外です
- スクリプトで大量のファイルを操作する場合は、Git コミットで手動チェックポイントを作成してください
- Checkpointing は Git の代替ではなく補完機能として位置付けます
